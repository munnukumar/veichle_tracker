{
  "openapi": "3.0.0",
  "info": {
    "title": "Vehicle Rental API",
    "version": "1.0.0",
    "description": "API documentation for the Vehicle Rental service, including User, Vehicle, Payment, GPS, and Booking modules."
  },
  "servers": [
    {
      "url": "http://localhost:8000/api",
      "description": "Base API URL"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/users/create": {
      "post": {
        "tags": ["User"],
        "summary": "Create a new user (Registration)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully"
          },
          "400": {
            "description": "Invalid input"
          }
        }
      }
    },
    "/users/login": {
      "post": {
        "tags": ["User"],
        "summary": "User login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful, returns token"
          },
          "401": {
            "description": "Unauthorized/Invalid Credentials"
          }
        }
      }
    },
    "/users": {
      "get": {
        "tags": ["User"],
        "summary": "Admin: Get all users",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of users"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN role)"
          }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "tags": ["User"],
        "summary": "Get user by ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "User ID"
          }
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User details"
          },
          "404": {
            "description": "User not found"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN or USER role)"
          }
        }
      }
    },
    "/users/update": {
      "patch": {
        "tags": ["User"],
        "summary": "User: Update own profile",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUserRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully"
          },
          "403": {
            "description": "Forbidden (Requires USER role)"
          }
        }
      }
    },
    "/users/kyc/{id}": {
      "patch": {
        "tags": ["User"],
        "summary": "Admin: Update user KYC status",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "User ID"
          }
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateKycRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "KYC status updated"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN role)"
          }
        }
      }
    },
    "/vehicles/add": {
      "post": {
        "tags": ["Vehicle"],
        "summary": "Admin: Create a new vehicle",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateVehicleRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Vehicle created successfully"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN role)"
          }
        }
      }
    },
    "/vehicles": {
      "get": {
        "tags": ["Vehicle"],
        "summary": "Get a list of all vehicles",
        "responses": {
          "200": {
            "description": "List of vehicles"
          }
        }
      }
    },
    "/vehicles/{id}": {
      "patch": {
        "tags": ["Vehicle"],
        "summary": "Admin: Update vehicle details",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "Vehicle ID"
          }
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateVehicleRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Vehicle updated successfully"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN role)"
          }
        }
      }
    },
    "/payment/order": {
      "post": {
        "tags": ["Payment"],
        "summary": "User: Create a Razorpay order",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRazorpayOrderRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Razorpay order created"
          },
          "403": {
            "description": "Forbidden (Requires USER role)"
          }
        }
      }
    },
    "/payment/verify": {
      "post": {
        "tags": ["Payment"],
        "summary": "Verify Razorpay payment status",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VerifyRazorpayPaymentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment verified"
          },
          "400": {
            "description": "Verification failed"
          }
        }
      }
    },
    "/gps/update": {
      "post": {
        "tags": ["GPS"],
        "summary": "Update vehicle location (from GPS device)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateVehicleLocationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Location updated"
          }
        }
      }
    },
    "/gps/{id}": {
      "get": {
        "tags": ["GPS"],
        "summary": "Get vehicle's current location by Vehicle ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "Vehicle ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Vehicle location data"
          },
          "404": {
            "description": "Vehicle not found"
          }
        }
      }
    },
    "/bookings/create": {
      "post": {
        "tags": ["Booking"],
        "summary": "Create a new booking",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBookingRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Booking created"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/bookings/{id}": {
      "get": {
        "tags": ["Booking"],
        "summary": "Get booking details by ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "Booking ID"
          }
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Booking details"
          },
          "404": {
            "description": "Booking not found"
          }
        }
      }
    },
    "/bookings/cancel/{id}": {
      "patch": {
        "tags": ["Booking"],
        "summary": "Cancel a booking by ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "objectId"
            },
            "description": "Booking ID"
          }
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Booking cancelled"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/bookings/history": {
      "get": {
        "tags": ["Booking"],
        "summary": "Admin: Get all booking history",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of all bookings"
          },
          "403": {
            "description": "Forbidden (Requires ADMIN role)"
          }
        }
      }
    },
    "/availability/list": {
      "get": {
        "tags": ["Availability"],
        "summary": "Check vehicle availability",
        "description": "This route is missing in the provided code, but typically exists in an 'availability' module.",

        "responses": {
          "200": {
            "description": "List of available vehicles or status"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "KycStatus": {
        "type": "string",
        "enum": ["PENDING", "VERIFIED", "REJECTED"]
      },
      "Kyc": {
        "type": "object",
        "properties": {
          "documentType": {
            "type": "string",
            "enum": ["aadhaar", "passport", "license"]
          },
          "documentNumber": {
            "type": "string"
          },
          "frontImage": {
            "type": "string"
          },
          "backImage": {
            "type": "string"
          },
          "status": {
            "$ref": "#/components/schemas/KycStatus",
            "default": "PENDING"
          },
          "rejectionReason": {
            "type": "string"
          },
          "submittedAt": {
            "type": "string",
            "format": "date-time"
          },
          "verifiedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "name": {
            "type": "string",
            "description": "Full name",
            "example": "Jane Doe"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Unique email address"
          },
          "role": {
            "type": "string",
            "enum": ["USER", "ADMIN"],
            "default": "USER"
          },
          "isBlocked": {
            "type": "boolean",
            "default": false
          },
          "kyc": {
            "$ref": "#/components/schemas/Kyc"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["name", "email"]
      },
      "Vehicle": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "title": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["car", "bike", "scooter"]
          },
          "numberPlate": {
            "type": "string",
            "description": "Unique number plate"
          },
          "brand": {
            "type": "string"
          },
          "model": {
            "type": "string"
          },
          "color": {
            "type": "string"
          },
          "price": {
            "type": "number",
            "description": "Rental price per unit time (e.g., hour/day)"
          },
          "isAvailable": {
            "type": "boolean",
            "default": true
          },
          "isActive": {
            "type": "boolean",
            "default": true
          }
        },
        "required": ["title", "type", "numberPlate"]
      },
      "Payment": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "user": {
            "type": "string",
            "format": "objectId",
            "description": "Reference to User"
          },
          "booking": {
            "type": "string",
            "format": "objectId",
            "description": "Reference to Booking"
          },
          "amount": {
            "type": "number"
          },
          "paymentStatus": {
            "type": "string",
            "enum": ["PENDING", "SUCCESS", "FAILED", "REFUNDED"],
            "default": "PENDING"
          },
          "transactionId": {
            "type": "string"
          },
          "paymentId": {
            "type": "string",
            "description": "Razorpay Order ID or Payment ID"
          },
          "paymentMethod": {
            "type": "string"
          }
        },
        "required": ["user", "booking", "amount"]
      },
      "GPSLocation": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "vehicleId": {
            "type": "string",
            "format": "objectId",
            "description": "Reference to Vehicle"
          },
          "latitude": {
            "type": "number"
          },
          "longitude": {
            "type": "number"
          },
          "speed": {
            "type": "number"
          },
          "isOnline": {
            "type": "boolean",
            "default": true
          },
          "lastUpdated": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["vehicleId"]
      },
      "Booking": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "userId": {
            "type": "string",
            "format": "objectId",
            "description": "Reference to User"
          },
          "vehicleId": {
            "type": "string",
            "format": "objectId",
            "description": "Reference to Vehicle"
          },
          "from": {
            "type": "string",
            "format": "date-time",
            "description": "Booking start time"
          },
          "to": {
            "type": "string",
            "format": "date-time",
            "description": "Booking end time"
          },
          "totalAmount": {
            "type": "number"
          },
          "status": {
            "type": "string",
            "enum": ["PENDING", "CONFIRMED", "CANCELLED", "COMPLETED"],
            "default": "PENDING"
          },
          "paymentStatus": {
            "type": "string",
            "enum": ["PENDING", "SUCCESS", "FAILED", "REFUNDED"],
            "default": "PENDING"
          },
          "isPaid": {
            "type": "boolean",
            "default": false
          },
          "pickupLocation": {
            "type": "string"
          },
          "dropLocation": {
            "type": "string"
          }
        },
        "required": ["userId", "vehicleId", "from", "to"]
      }
    },
    "requestBodies": {
      "CreateUserRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "email": {
                  "type": "string",
                  "format": "email"
                },
                "password": {
                  "type": "string",
                  "minLength": 6
                }
              },
              "required": ["name", "email", "password"]
            }
          }
        }
      },
      "LoginRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string",
                  "format": "email"
                },
                "password": {
                  "type": "string"
                }
              },
              "required": ["email", "password"]
            }
          }
        }
      },
      "UpdateUserRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "password": {
                  "type": "string",
                  "minLength": 6
                },
                "kyc": {
                  "type": "object",
                  "properties": {
                    "documentType": {
                      "type": "string",
                      "enum": ["aadhaar", "passport", "license"]
                    },
                    "documentNumber": {
                      "type": "string"
                    },
                    "frontImage": {
                      "type": "string"
                    },
                    "backImage": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "UpdateKycRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "$ref": "#/components/schemas/KycStatus"
                },
                "rejectionReason": {
                  "type": "string",
                  "description": "Required if status is REJECTED"
                }
              },
              "required": ["status"]
            }
          }
        }
      },
      "CreateVehicleRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "type": {
                  "type": "string",
                  "enum": ["car", "bike", "scooter"]
                },
                "numberPlate": {
                  "type": "string"
                },
                "brand": {
                  "type": "string"
                },
                "model": {
                  "type": "string"
                },
                "color": {
                  "type": "string"
                },
                "price": {
                  "type": "number"
                }
              },
              "required": ["title", "type", "numberPlate"]
            }
          }
        }
      },
      "UpdateVehicleRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "type": {
                  "type": "string",
                  "enum": ["car", "bike", "scooter"]
                },
                "brand": {
                  "type": "string"
                },
                "model": {
                  "type": "string"
                },
                "color": {
                  "type": "string"
                },
                "price": {
                  "type": "number"
                },
                "isAvailable": {
                  "type": "boolean"
                },
                "isActive": {
                  "type": "boolean"
                }
              }
            }
          }
        }
      },
      "CreateRazorpayOrderRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "amount": {
                  "type": "number",
                  "description": "Amount in smallest currency unit (e.g., paise)"
                },
                "bookingId": {
                  "type": "string",
                  "format": "objectId"
                }
              },
              "required": ["amount", "bookingId"]
            }
          }
        }
      },
      "VerifyRazorpayPaymentRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "razorpay_order_id": {
                  "type": "string"
                },
                "razorpay_payment_id": {
                  "type": "string"
                },
                "razorpay_signature": {
                  "type": "string"
                }
              },
              "required": [
                "razorpay_order_id",
                "razorpay_payment_id",
                "razorpay_signature"
              ]
            }
          }
        }
      },
      "UpdateVehicleLocationRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "vehicleId": {
                  "type": "string",
                  "format": "objectId"
                },
                "latitude": {
                  "type": "number"
                },
                "longitude": {
                  "type": "number"
                },
                "speed": {
                  "type": "number"
                },
                "isOnline": {
                  "type": "boolean"
                }
              },
              "required": ["vehicleId", "latitude", "longitude"]
            }
          }
        }
      },
      "CreateBookingRequest": {
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "vehicleId": {
                  "type": "string",
                  "format": "objectId"
                },
                "from": {
                  "type": "string",
                  "format": "date-time"
                },
                "to": {
                  "type": "string",
                  "format": "date-time"
                },
                "pickupLocation": {
                  "type": "string"
                },
                "dropLocation": {
                  "type": "string"
                }
              },
              "required": ["vehicleId", "from", "to"]
            }
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT authentication required for USER/ADMIN roles"
      }
    }
  }
}
